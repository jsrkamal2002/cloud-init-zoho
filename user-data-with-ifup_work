#cloud-config

#Hostname
hostname: debian

#For default user - debian
password: debian
chpasswd:
  expire: False

# User Configuration
users:
  - name: rajkamal
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    groups: sudo
    shell: /bin/bash
    passwd: $6$C9WYLiXRjYgQwY0U$LDCi4h6ZFk/zMtvrZ77jmw1pZY.dwcJhu1WdEkG2LO25ijhCQaqqwVyCd7mJcudzagtMhIP06QOdVGpuRSUp1/
    lock_passwd: false

# SSH Configuration
ssh_pwauth: true

write_files: 
  - path: /etc/network/interfaces 
    owner: root:root 
    permissions: '0644' 
    content: |
      # Generated by cloud-init 
      # Loopback network interface
      auto lo 
      iface lo inet loopback
      # Primary network interface
      auto enp1s0
      iface enp1s0 inet static
        address 192.168.122.160
        netmask 255.255.255.0
        gateway 192.168.122.1

# Network area
network:
  version: 1
  config:
    - type: physical
      name: enp1s0
      subnets:
        - type: dhcp

# Packages to install
packages:
  - ifupdown

runcmd:
  - apt remove -y netplan.io
  - apt autoremove -y
  - rm -rf /etc/netplan
  - systemctl restart networking
  - [ sh, -c, "systemctl disable systemd-networkd-wait-online.service" ]
  - [ sh, -c, "systemctl mask systemd-networkd-wait-online.service" ]
  - ifup enp1s0

power_state:
  delay: now
  mode: reboot
  message: "Rebooting to apply network interface changes"

